\appendix
%\renewcommand*{\thesection}{\arabic{section}}
\renewcommand*{\thesubsection}{\thesection.\arabic{subsection}}
\renewcommand*{\thesubsubsection}{\thesubsection.\arabic{subsubsection}}

\section{WBS Tables}
\label{sec:wbs}
%WBS tables:

\clearpage
%\begin{figure*}[ht]
%\centering
%\vspace*{-5mm}
%\includegraphics[angle=0,width=\textwidth]{cost_schedule/HPSV470p1} 
%\caption{HPS WBS.}
%\label{fig:schedulea}
%\end{figure*}

\includepdf[pages=1-9,angle=90,scale=0.8]{cost_schedule/HPSV470.pdf}
%\begin{rotate}{90}

\section{Additions and improvements to the HPS setup using non-DOE sources of funding}

While the proposed baseline equipment will be sufficient to carry out proposed measurements, the HPS collaboration is seeking funding from non-DOE sources to improve and enhance capabilities of the HPS detector. Plans for improvements include light monitoring system and large area APDs for ECal.  The HPS collaborators from IPN Orsay have applied for a number of European grants, including European Research Council (ERC) Advanced Grant 2013 to purchase APDs, for manpower costs to replace the old ones, to design and build 
new preamplifier boards, and to assemble and test the ECal with the new modules. The total cost of replacing all ECal APDs is about $500$K\$. 
These grants also include light monitoring system. If successful European funding will cover most of the ECal modifications, and will significantly reduce the support needed from DOE for the more modest upgrades we have proposed above. 

Besides ECal improvements, collaboration intend to add muon detector to the HPS setup. Collaborators from the Collage of William\&Mary (PI Prof. Keith Griffion) togetehr with collaborators from Rutgers University (PI Prof. Yuri Gerstein) and Old Dominion University (PI Prof. Lary Weinstein) submitted an MRI proposal to NSF for the Muon System, requesting $\sim 300$k.  

Below the details of ECal improvements, and the motivation and description of the muon system are presented. 

\subsection{Improvements to ECal}

\begin{enumerate}
\item {\bf Light monitoring system}

For an experiment like HPS, where backgrounds must be well understood and need to be strongly suppressed, the trigger bias must be minimized. In particular, having stable, known, and uniform thresholds at the trigger readout is necessary in order to avoid  bias in the 
event selection. Such uniformity and stability can be achieved with the installation of an online gain monitoring 
system. This system will introduce short light pulses into the front face of the crystals. The crystals already have fiber holders attached, allowing implementation of this system without having to modify the crystals or wrapping. 

Optical fibers will be used to transmit light from a calibration  source to the crystals to test the response of the APDs. The response of the system could change in time because of 
losses in crystal transparency due to radiation damage or because of gain variations of the APDs. 
Such a calibration system has been developed for several experiments (CMS at CERN for instance) with various light sources. The system for the ECal 
will be developed at IPN Orsay during 2013 and in the first half of 2014, and will be ready for installation at JLAB for the commissioning run in the fall of 2014. Each module will have a red and blue mono-color LED light source for monitoring purposes. 
Blue light transmission, corresponding to the domain of the crystal's emission spectrum, is very sensitive to the presence of color centers which are produced by radiation damage. So the blue light source will monitor variations of the response in the main domain of the spectrum.
 %Impurities can anneal at room temperature and such monitoring can be sensitive to increasing of output as well, when the radiation exposure is reduced for a long period of time. 
The response to red light is less sensitive to the color centers,  and so permits monitoring the APD gains more directly. Thus the use of two colors separates gain variations due to the 
APD and electronics from those due to changes in the crystal transparency, and provides clear information on the state of the electronics. 
The main challenge for the system is to guarantee stability at a level of $2\%$. The test of the system will be carried-out at
IPN Orsay, in order to study its efficacy and also to test the radiation resistance of the various materials.

\item {\bf Modifications to the side brackets to accommodate fiber bundles for the light monitoring system} -
A light monitoring system was not used during the test run. While the design of the ECal enclosure was done in such a way that it can 
accommodate optical fibers attached to the front face of crystals, the side plates that hold the crystal frames do not have inlets for the accompanying fiber bundles.
Space is available on the side plates for a straight-forward modification which will allow the addition of a light monitoring system.  
    
\item {\bf New low-voltage power supply} - The existing low voltage power supply is a manually controlled, single output power supply 
that feeds the four ECal motherboards through a custom-made patch panel. The present system cannot control the voltage supplied to preamplifiers at different
parts of the ECal, and controlling or resetting them remotely has proved to be very inconvenient, requiring frequent access to the Hall, especially during commissioning. Newly available low voltage power supplies are much more flexible. The one that is the most suitable for the
ECal APD preamplifiers is the WIENER MPV 8008LD. This power supply is being used at JLAB and the control software exists, so it will be easy to incorporate it into HPS.     

\item {\bf New preamplifiers} - A low noise, low gain preamplifiers will be needed to take advantage of increased signal on the input of FADC after removing the spliter. The impact of the lower noise/threshold system is twofold: first it 
will improve the ECal's energy resolution; and second it will make the ECal sensitive to minimum ionizing particles which pass through the crystals transversely. With sensitivity to cosmic ray muons, which will pass through the ECal transversely when it is installed in HPS, the Ecal crystals can be calibrated for MIPS, and their effective gains balanced.  HPS collaborators from INFN Genova have shown that with such a low noise, low threshold system, the ECal can distinguish the MIP energy deposition from noise, see left plot on Figure \ref{fig:mip10x10}.

%\begin{figure*}[t]
%\includegraphics[scale=0.4]{ecal/MIP_5x5_APD.png}
%\caption{\small{Charge distribution from readout of the HPS calorimeter crystal with Hamamatsu S8664-55 APD, and the new low noise amplifier board. The red line histogram corresponds to the charge distribution for all triggers coming from the scintillators positioned above and below the crystal. The black line shows the distribution for hits in the crystal within $100$ ns of the trigger signal. }}\label{fig:mip5x5}
%\end{figure*}


\item{\bf Possibilities with new APDs} - Installing new APDs on the existing crystals will significantly improve the ECal performance, but doing so is expensive,  so replacement is only being considered if a funding source beyond DOE HEP is secured. Replacing the old $5\times 5$ mm$^2$ 
Hamamatsu S8664-55 APDs with $10\times 10$ mm$^2$, Hamamatsu S8664-1010 will improve two critical characteristics of the present calorimeter modules. First, the new APDs from Hamamatsu have much better performance than the ones which are currently installed. Data from Hamamatsu shows that APDs made from the same wafer have excellent gain uniformity. With $\pm 10\%$ known uniformity 
at the gain of $100$, the required variations in bias voltage are only $\sim 4.5$ V. Even for large samples of APDs (~1300),  the required bias voltage differences are ~50 V, which is half that of the current APDS. The ECal supplies bias voltage to groups of APDs, so with new APDs, with their smaller voltage-gain variations, it will be possible to achieve much better 
uniformity in the response of the calorimeter modules, and consequently better uniformity in trigger thresholds. 

Secondly, the new APDs have a $4$ times larger readout area, ensuring $4$ times more light collection and therefore $4$ times larger signals. This will allow the use of lower gain amplifier modules which in turn will decrease electronic noise. Tests 
performed for another calorimeter, now in production at INFN Genova for JLAB Hall-B, showed that amplifier boards 
with a factor 2 lower gains have a noise level $<5$ MeV. The energy deposition in the HPS PbWO$_4$ crystals  
from minimum ionizing cosmic muons passing transversely to the crystal axis is $\sim 15$ MeV. Moving the energy thresholds 
close to $5$ MeV will allow the MIP peak to be clearly distinguished, and will let the calorimeter  be calibrated and monitored with cosmic muons. The HPS collaborators 
from the INFN group have performed the first tests of the Hamamtsu $10\times 10$ mm$^2$ APDs and a new amplifier board on HPS crystals. In 
Figure \ref{fig:mip10x10}, the charge distribution of a single crystal system is shown for $5\times 5$ mm$^2$ (left) and $10\times 
10$ mm$^2$ (right) APDs. A coincidence signal from scintillator telescopes positioned above and below the module provides the trigger. 
The crystal was positioned horizontally as it would be in HPS, so the cosmic muons would pass through it perpendicular to the crystal axis. The red line 
histogram is for all events triggered by the scintillation telescope and corresponds to the noise. The black line histogram corresponds 
to the charge detected within $100$ ns of the trigger time. The MIP peak is clearly visible and well isolated from the noise 
for the S8664-1010 APD readout. For  the S8664-55 APD, the MIP signal is also seen, but its charge distribution is under the noise peak and it
does not have well defined peak position. Using MIP calibration in conjunction with the light monitoring system will ensure stable and reliable performance of the ECal and the trigger system. As a bonus, the lower noise will allow the use of lower  thresholds and improve the calorimeter's energy resolution. The new amplifier boards have to be designed to work with new APDs. 

\begin{figure*}[t]
\includegraphics[scale=0.37]{ecal/MIP_5x5_APD.png}
\includegraphics[scale=0.37]{ecal/MIP_10x10_APD.png}
\caption{\small{Charge distribution from readout of the HPS calorimeter crystal with Hamamatsu S8664-55 (left) and S8664-1010 
(right) APDs, and the new low noise amplifier board. The red line histogram corresponds to the charge distribution for all triggers 
comming from the scintillators positioned above and below the crystal. The black line shows the distribution for hits in the crystal 
within $100$ ns of the trigger signal. }}\label{fig:mip10x10}
\end{figure*}

\end{enumerate}


\input{muon/muon_system}
\clearpage

\section{Simulation Tools}
\label{app:sim}

The simulation tools play a critical role in simulating the background
environment, optimizing the detector setup, and developing the trigger 
and reconstruction strategies. We use GEANT4 and EGS5 to simulate 
electromagnetic interactions. There is generally good agreement 
between these two codes. In particular, no inconsistencies have been 
found on secondary particle yields or energy spectra. However, we have found 
significant disagreements on the angular distributions in the multiple
scattering, bremsstrahlung and pair production processes.  

%\vspace{1cm}
%\noindent
%{\bf Multiple Scattering}
\subsection*{Multiple Scattering Simulation}

EGS5 simulates the electron elastic scattering using the Moli\`{e}re theory 
\cite{moliere} as formulated by Bethe. \cite{bethe}
It is based on a small angle approximation
($\theta \ll$ 1 radian), and the angular distribution approaches asymptotically
to Gaussian at small angles, and to Rutherford's Coulomb scattering function at 
large angles given by, 
\begin{equation}
F(\theta) \sim  { \frac{1} {\left(1-cos\theta + {\frac{\chi^2} {2}}\right)^2}}.
\label{eq:rutherford}
\end{equation}

Instead of using the complex and time consuming Moli\`{e}re's formula,
GEANT4 uses two functions explicitly, Gaussian at small angles and the
Rutherford function Eq.~\ref{eq:rutherford} at large angles with a requirement that these two
functions and their first derivatives are joined continuously. 
GEANT4, however, uses a different power
in the denominator in Eq.~\ref{eq:rutherford} which is close to 2 but not exactly equal to 2 and is 
dependent on the target material and thickness.

Several comparisons have been made in the angular distribution $F(\theta)$ in the
differential cross section $d\sigma=F(\theta)d(cos\theta) d\phi$ for 2.2 GeV electron
scattering from 0.125\% $X_0$ Tungsten target. 
The EGS5 simulation is compared with Moli\`{e}re's analytical formula 
in Figure \ref{appendix:1}(a), demonstrating a good agreement between EGS5 and
the Moli\`{e}re theory.
While the Moli\`{e}re theory is based on a small angle approximation,
the multiple scattering theory developed by Gaudsmit and Saunderson is valid 
for any angle by means of an expansion in Legendre polynomials. \cite{gs}
The validity of the small angle approximation is checked by comparing the 
Moli\`{e}re integral with 
the Goudsmit-Saunderson theory as shown in Figure \ref{appendix:1}(b),
demonstrating that the Moli\`{e}re theory is accurate in the angular region
of the HPS detector. 

\begin{figure*}[ht]
\includegraphics[height=3 in]{appendix/appendix_1-eps-converted-to.pdf}
\caption{\small{ (a) Moli\`{e}re vs. EGS5 \hspace{1 cm} (b) Moli\`{e}re vs. Goudsmit-Saunderson}}
\label{appendix:1}
\end{figure*}

Figure \ref{appendix:2} shows the angular distribution comparison between the GEANT4 
simulation and the Moli\`{e}re integral. 
GEANT4 is in good agreement with the Moli\`{e}re integral up to about 1 mrad, then it 
deviates at larger angles, predicting roughly twice the cross section at 15 mrad, 
where the HPS tracker sensor edge is located.

D. Attwood et al. measured 170 MeV muon angular distributions and compared with 
GEANT4 simulations and the Moli\`{e}re theory. \cite{attwood} They concluded that GEANT4 
simulation over-estimated the scattering tail by about a factor of two, and the data were consistent
with the Moli\`{e}re theory. G. Shen et al.~ \cite{shen} and B. Gottschalk et al.~ \cite{gottschalk}
also showed that the Moli\`{e}re theory was consistent with the measurements on a wide variety of
target materials.

\begin{figure}[ht]
\includegraphics[height= 3 in]{appendix/appendix_2-eps-converted-to.pdf}
\caption{\small{ Moli\`{e}re vs. GEANT4 }}
\label{appendix:2}
\end{figure}

%\vspace{1cm}
%\noindent
%{\bf Angular distributions in the bremsstrahlung and pair production processes}
\subsection*{Angular Distributions}

While GEANT4 and EGS5 are in good agreement in the production rates and the secondary particle
energy spectra, there are significant differences in the angular distribution in the secondary
particles. In EGS5, the angular distributions are sampled from the following differential
cross section for the bremsstrahlung process, \cite{koch}

$$d\sigma(k,\theta_\gamma) = {\frac{4Z^2r_0^2} {137}} {\frac{dk} {k}} ydy\left\{{\frac{16y^2E} 
{(y^2+1)^4E_0}}
 -{\frac{(E_0+E)^2} {(y^2+1)^2E_0^2}}+\left\{{\frac{E_0^2+E^2} {(y^2+1)^2E_0^2}} -
 {\frac{4y^2E} {(y^2+1)^4E_0}}\right\} lnM(y) \right\}, $$

\noindent
where $k$ is photon energy, $\theta_\gamma$ is photon polar angle, $E_0$ and $E$ are initial and final 
electron energy, and

$$y=E_0\theta_\gamma; {\frac{1} {M(y)}} = \left({\frac{k} {2E_0E}}\right)^2 + \left({\frac{Z^{1/3}} {111(y^2+1)}}\right)^2, $$

\noindent
and for the pair production process, \cite{motz}

$${\frac{d\sigma} {dE_\pm d\Omega_\pm}} = {\frac{2\alpha Z^2r_0^2} {\pi}} {\frac{E_\pm^2} {k^3}}
\left\{-{\frac{(E_+-E_-)^2} {(u^2+1)^2}}-{\frac{16u^2E_+E_-} {(u^2+1)^4}} + \left\{ {\frac{E_+^2+E_-^2} 
{(u^2+1)^2}} + {\frac{4u^2E_+E_-} {(u^2+1)^4}} \right\} lnM(u)\right\},$$

\noindent
where $k$ photon energy, $E_\pm$ $e^{\pm}$ energy, $\theta_\pm$ $e^{\pm}$ polar angle, and

$$u=E_\pm\theta_\pm; {\frac{1} {M(u)}} = \left({\frac{k} {2E_+E_-}}\right)^2+\left({\frac{Z^{1/3}} {111(u^2+1)}}\right)^2.$$

\noindent
GEANT4 uses an approximate function to simulate the angular distributions in the 
bremsstrahlung and pair production processes given by

$$ f(u) = C [ue^{-au} + d u e^{-3au}], $$

\noindent
with $u=E_0\theta_\gamma$ for incident electron energy $E_0$ and the polar angle 
$\theta_\gamma$ of the bremsstrahlung photon, and $u=E_{\pm}\theta_{\pm}$ for the pair 
energy $E_\pm$ and polar angle $\theta_\pm$ in the pair production. Since the production angle
is typically $1/\gamma$, GEANT4's approximations are acceptable
for most of the high energy detector simulations. However, GEANT4
simulations are inconsistent with the data in the following two cases in the HPS Test Run:
\begin{itemize}
\item The bremsstrahlung photon angular distribution is too narrow, 
resulting in too few scatters in the collimator.
\item The prediction on the pair angular distribution is too narrow, resulting in 
too few Ecal trigger rates.
\end{itemize}

%\vspace{1cm}
%\noindent
%{\bf Conclusions}
\subsection*{Simulation Tools Setup in HPS}

Because of the inaccuracies in GEANT4 described above the electromagnetic interactions in the target are simulated 
by EGS5, and all the particles that come out of the target are passed on to the HPS detector 
simulation system based on GEANT4.


%\input{measurements/appendix_production_and_decay}

% \section{Test Run SVT Performance}
% \label{app:svt}
% \subsection*{SVT Calibration}

% \input{test2012/svtperformance/svt_calib/svt_calibrations}

% \subsection*{SVT Hit Time Resolution}
% As discussed in Sec.~\ref{sec:svt}, the APV25 multi-peak readout is crucial to the time stamping on hits
% in the SVT. This, in turn, allows the effective occupancies to be lowered for pattern recognition
% during electron running. 
% Six samples of the APV25 shaper output for each trigger are fitted to an ideal $CR-RC$ function to 
% extract the amplitude and hit time.  The $\chi^2$ distribution of these fits from test run data is as expected
% for four degrees of freedom.
% %\begin{figure}[]
% %	\includegraphics[width=0.6\textwidth]{test2012/svtperformance/apvfit_chisq}
% %	\caption{\small{Histogram of $\chi^2$ values for pulse fits for all channels on a representative sensor. The peak at 2 is consistent with 4 degrees of freedom (2 fit parameters), as expected. Pileup was not considered due to the very low hit rate in 
% %the SVT in this photon beam test. } }
% %	\label{fig:apvfit}
% %\end{figure}
% After clustering hits on a sensor, the hit time for each cluster is computed as the 
% amplitude-weighted average of the channel hit times. Since we have no measurement of the ``true'' hit time, we study the overall SVT hit 
% timing performance using the average of all cluster times in a track as the ``track time,'' and take the
%  residual of the cluster time relative to that. The observed track time, shown in Fig.~\ref{fig:tracktime}, has the expected amount of trigger jitter due to the readout clock and trigger system jitter. After correcting for offsets for each sensor (time-of-flight, clock phase) the RMS 
%  of the final residual distribution is roughly 2.4~ns for each sensor. 
% Because the track time is calculated using the individual hit times, the hit time is positively correlated 
% with the track time; thus the RMS of the residual is slightly smaller than the true time resolution.
% The standard deviation of this residual for $n$-hit tracks where all hits have the same time resolution 
% is reduced by a factor of $\sqrt{(n-1)/n}$; since most of our tracks have 8 clusters, the true time 
% resolution is 2.6 ns. 
% %\begin{figure}[ht]
% %	\includegraphics[width=\textwidth]{test2012/svtperformance/timeres}
% %	\caption{\small{Histogram and Gaussian fit of residual of cluster times for a representative sensor, relative to the track time. Because the cluster times and track time have positive covariance, the true time resolution is slightly larger than the standard deviation shown here.} }
% %	\label{fig:timeres}
% %\end{figure}
% %\begin{figure}[ht]
% %	\includegraphics[width=\textwidth]{test2012/svtperformance/hit_dt}
% %	\caption{\small{} }
% %	\label{fig:hit_dt}
% %\end{figure}
% This is somewhat worse than the $\approx 2$ ns resolution expected 
% %(see Fig.~\ref{fig:timeres}) 
% in 
% Sec.~\ref{sec:performance}, but we believe this discrepancy is due to our fit function. Our pulse 
% shape fit assumes an ideal CR-RC pulse shape; since the actual pulse shape has a slower rise time, 
% there is a systematic pull on the hit time when a hit comes immediately before the APV clock time. 
% This is visible in Figure \ref{fig:timeres_2D} as a shift in the residual at certain values of track time.
% \begin{figure}[ht]
% 	\includegraphics[width=0.7\textwidth]{test2012/svtperformance/timeres_2D}
% 	\caption{\small{Plot of the time residual for a representative sensor vs. the track time. 
% 		The kinks in the horizontal band are caused by the fitter; without them the time resolution (measured by taking the projection of this histogram) would be better.} }
% 	\label{fig:timeres_2D}
% \end{figure}
% Work is in progress to use the actual pulse shape in time reconstruction; this should improve time resolution to that expected from previous studies. 
% Reducing the APV25 pulse shaping time will also improve time resolution.
% In short, these results show that we can achieve time resolution adequate for pileup rejection during electron running.
% %\vspace{1cm}{\bf Tracking algorithms [Matt/Omar]}


% \subsection*{SVT Track Reconstruction}
% \input{test2012/svtperformance/trk_performance/trk_performance}

% \subsection*{SVT Test Run DAQ Performance}
% \input{test2012/svtperformance/daq/svt_daq_perf.tex}

\section{Test Run ECal Calibration}
\label{sec:ecal_calib}

The noise and pedestal of the readout chain are calibrated by running the ECal readout in a mode where the preamplifier output is sampled every 4~ns in a time window of 100 samples: by looking at a part of the window before the hit, we calibrate the readout channel.

We calibrate gain of the individual ECal channels using the SVT measurement of track momentum and comparison to Monte Carlo simulation. 
% The ratio of cluster energy to track momentum is calculated both for Monte Carlo simulation and test run data at each point in the ECal, and we find the value of gain for each channel that brings the two into agreement.
We disable all SVT and ECal channels in the simulation that were inoperable or noisy in the test run, so any efficiency or bias effects that affect the real data should be reflected in the simulation as well; then we use a formula to compute the ``weighted E/p'' for a crystal, representing the average E/p for clusters that include the crystal: $\frac{\sum_j w_{j,i}}{\sum_j\frac{P_j}{E_j}w_{j,i}}$, and iteratively adjust the gains until the weighted E/p is equal for test run data and simulation.

% The calibrated gains are corrected by the ratio between the weighted E/p values from Monte Carlo and real data.
% The E/p in Monte Carlo data is also affected by the gain because the trigger thresholds change, so both Monte Carlo and data reconstruction are rerun with each iteration of gain calibration.
% It takes up to 4 iterations for the gains to stabilize; the final values are shown in Figure \ref{fig:gains}.
\begin{figure}[ht]
	\includegraphics[width=0.45\textwidth]{test2012/ecalperformance/ecalgainplots_corr_sim}
	\includegraphics[width=0.45\textwidth]{test2012/ecalperformance/gains}
	\caption{\small{Weighted E/p from Monte Carlo simulation (left), calibrated values of gain in units of MeV per ADC count (right).}}
	\label{fig:gains}
\end{figure}

These gains can then be used to convert from ADC counts in a channel to the energy deposited into that ECal crystal.
The other information needed to find the energy of an incident particle is the sampling fraction---the ratio of energy read out from crystals to energy of an incident particle.
The conventional sampling fraction---the fraction of incident energy that is deposited in crystals---is approximately 0.9 for our ECal, and less at edges.
For our readout, there is additional energy lost because crystals under the readout threshold are not read out.
The weighted E/p used in calibration (see Figure \ref{fig:gains}) is an approximate measurement of sampling fraction, but the sampling fraction is energy-dependent because of the effect of readout threshold. 
A full computation of sampling fraction can be done using simulation.
